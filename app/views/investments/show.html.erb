<div class="container transaction-actions">
  <h2>Trade Asset</h2>

  <div class="chart-wrapper" data-controller="performance-chart">
    <div class="chart-container">
      <canvas id="bar-chart"
              data-performance-chart-target="myChart"
              data-labels="<%= @investment.histories.map { |history| history.date.strftime('%Y-%m-%d') }.to_json %>"
              data-prices="<%= @investment.histories.map(&:price).to_json %>" width="4" height="1"
              data-purchased-price="<%= @purchased_price.to_json %>">
      </canvas>
    </div>
  </div>

<div class="trade-column">

      <h3>Today's price: <%= @investment.histories.last.price %>€</h3>

  <!-- Buy Form -->
    <div class="trade-form">
      <div class="buy form-column" data-controller="buying-investment">
        <%= simple_form_for [@investment, @holding] do |f| %>
        <%= f.input :shares_amount, input_html: { data: { buying_investment_target: "buyPrice", action: "change->buying-investment#activeButton" } } %>
        <%= f.hidden_field :trade, value: "buy" %>
        <%= f.submit "Buy     +", class: 'btn-buy-disabled', disabled: 'true', data: { buying_investment_target: "btn" } %>
        <% end %>
      </div>

  <!-- Sell Form -->
      <% if @on_hold %>
        <div class="sell form-column">
          <%= simple_form_for [@investment, @current_holding] do |f| %>
          <%= f.input :shares_amount %>
          <%= f.hidden_field :trade, value: "sell" %>
          <%= f.submit "Sell      -", class: 'btn-sell' %>
          <% end %>
        </div>
    </div>

      <div class="holding-info">
        <h3>Your holding:</h3>
        <h6>Inventory: <%= @current_holding.shares_amount %> Qty.</h6>
        <h6>Purchase Value: <%= (@current_holding.shares_amount * @current_holding.purchased_price).round(2) %> €</h6>
        <h6>Last transcation: <%= @current_holding.purchased_date %></h6>
        <h6>Purchased Price: <%= @current_holding.purchased_price %> €</h6>
        <h6>Change: <%= ((@investment.histories.last.price - @current_holding.purchased_price) * @current_holding.shares_amount).round(2) %> € (<%= (@investment.histories.last.price - @current_holding.purchased_price) / @current_holding.purchased_price * 100 %> %) </h6>
      </div>
      <% end %>
  </div>
</div>
