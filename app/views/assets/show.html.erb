

<!-- ... [other parts of the show page] ... -->

<div class="transaction-actions">
  <h3>Trade Asset</h3>

  <div data-controller="performance-chart">
  <%# <canvas id="bar-chart" data-performance-chart-target="myChart" data-prices="[12, 19, 3, 5, 2, 3]"  width="800" height="450"></canvas> %>

  <canvas id="bar-chart" data-performance-chart-target="myChart" data-prices="<%= Investment.last.histories.map(&:price) %>"  width="400" height="250"></canvas>
  </div>

  <!-- Buy Form -->
  <%= form_with(model: Holding.new, url: holdings_path, method: :post) do |form| %>
    <%= form.hidden_field :asset_id, value: @asset.id %>
    <div class="form-group">
      <%= form.label :quantity, "Buy Quantity" %>
      <%= form.number_field :quantity, min: 1, class: 'form-control' %>
    </div>
    <%= form.submit "Buy", class: 'btn btn-success' %>
  <% end %>

  <!-- Sell Form -->
  <!-- Ensure the user has holdings to sell -->
  <% if current_user.holdings.where(asset_id: @asset.id).any? %>
    <%= form_with(model: Holding.new, url: sell_holdings_path(@asset), method: :post) do |form| %>
      <%= form.hidden_field :asset_id, value: @asset.id %>
      <div class="form-group">
        <%= form.label :quantity, "Sell Quantity" %>
        <%= form.number_field :quantity, min: 1, class: 'form-control' %>
      </div>
      <%= form.submit "Sell", class: 'btn btn-danger' %>
    <% end %>
  <% else %>
    <p>You do not have any holdings to sell.</p>
  <% end %>
</div>
